#!/usr/bin/env bash

KEYBOARD="{{ KEYBOARD }}"
LOCALE="{{ LOCALE }}"
TIMEZONE="{{ TIMEZONE }}"

raspi-config nonint do_configure_keyboard $KEYBOARD
export LANG=$LOCALE
export LC_ALL=$LOCALE
export LANGUAGE=$LOCALE
raspi-config nonint do_change_locale $LOCALE
raspi-config nonint do_change_timezone $TIMEZONE

{{#Wifis}}
cat<<EOF > /boot/wpa_supplicant.conf 
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country={{COUNTRY}}

{{#Wifi}}
network={
  ssid="{{SSID}}"
  psk="{{PSK}}"
  key_mgmt={{KEYMGMT}}
}

{{/Wifi}}

{{/Wifis}}
EOF

